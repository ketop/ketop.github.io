---
title: "并发编程"
date: 2020-09-23T22:46:21+08:00
draft: true
---

## 并发与并行的概念
**并发**指两个或多个独立的活动在同一时段内发生。比如我们可以在听音乐的时候敲代码，这一时段内，我们的大脑是并发处理这些事情的。由于大脑处理事情是有次重点的，体现为同一时刻只能处理一个操作，但是交替处理多个事情。

**并行**指两个或者多个活动在同一时刻同时执行。判断一个程序是否并行执行，只需要看某个时刻是否存在多个工作单位在运行。在单核的CPU上不存在并行，在多核(SMP)CPU上，利用多线程或者多进程使得并发成为可能。

并发的程序设计，使我们能最大程度使用多核多线程来高效地处理问题，充分利用CPU的性能。

## 并发编程的方式
多进程和多线程是实现并发编程的两种方式。以一个多人项目为例，如果是假期在家远程协同办公，每个人都有自己的电脑，使用即使通讯工具来沟通。这种场景就是多进程模型。由于进程是操作系统资源分配的最小单位，因此多个进程是资源独立的，进程通过IPC方式进行通信。
如果这多个同学在学校实验室进行结对编程，共用同一个电脑，参考同一本编程指南，资源共享。这种场景就是多线程编程。由于线程是操作系统调度CPU的最下单位，因此执行粒度是最小的。同时由于内部资源共享，不需要过多的系统资源作为沟通的成本。但是也引来一个副作用：资源访问的一致性。

## C++中的并发编程API
C++11标准提供了一个新的线程库，内容包括了管理线程、保护共享数据、线程共享数据、线程同步操作、低级原子操作等类。
- <thread> 包含std::thread类和std::this_thread命名空间。管理线程的函数和类在此声明。
- <atomic> 包含std::atomic和std::atomic_flag类，以及一套C风格的原子类型与C兼容的原子操作的函数。
- <mutex> 包含了与互斥量相关的类以及其他类型和函数
- <future> 包含两个Provider类（std::promise和std::package_task）和两个Future类（std::future和std::shared_future）以及相关的类型和函数
- <condition_variable> 包含与条件变量相关的类，包括std::contidition_variable和std::condition_variable_any.

